import{a as s,c as de,f as b,t as O}from"../chunks/Dp4zGy6Y.js";import{o as Ae}from"../chunks/D1MHOrrt.js";import{ah as Ie,i as Re,P as Z,V as qe,ai as Ee,aj as Fe,ak as Se,al as Be,p as Ce,m as E,G as ue,o as C,h as De,s as o,k as _,g as e,j as n,t as F,l as i,n as D,F as Le}from"../chunks/BJmdqduM.js";import{d as Te,e as Ve,s as A,a as ee}from"../chunks/9hSCU5Uy.js";import{i as G}from"../chunks/eWemM8hH.js";import{e as ce,i as me}from"../chunks/DQGcvq5X.js";import{a as L,A as Q}from"../chunks/CObeKhF_.js";import{b as _e}from"../chunks/Cbs5zNOM.js";import{H as je,C as He}from"../chunks/Do8S-cRJ.js";import{D as pe}from"../chunks/Dbe2GJk8.js";import{B as te}from"../chunks/C46VhHkI.js";import{I as Ne}from"../chunks/D_U8r58x.js";import{B as fe}from"../chunks/CPLg08HV.js";import{M as Oe}from"../chunks/CQF6rH2y.js";function ae(t,g,I=!1){if(t.multiple){if(g==null)return;if(!qe(g))return Ee();for(var h of t.options)h.selected=g.includes(W(h));return}for(h of t.options){var z=W(h);if(Fe(z,g)){h.selected=!0;return}}(!I||g!==void 0)&&(t.selectedIndex=-1)}function xe(t){var g=new MutationObserver(()=>{ae(t,t.__value)});g.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Se(()=>{g.disconnect()})}function Ge(t,g,I=g){var h=new WeakSet,z=!0;Ie(t,"change",y=>{var P=y?"[selected]":":checked",x;if(t.multiple)x=[].map.call(t.querySelectorAll(P),W);else{var $=t.querySelector(P)??t.querySelector("option:not([disabled])");x=$&&W($)}I(x),Z!==null&&h.add(Z)}),Re(()=>{var y=g();if(t===document.activeElement){var P=Be??Z;if(h.has(P))return}if(ae(t,y,z),z&&y===void 0){var x=t.querySelector(":checked");x!==null&&(y=W(x),I(y))}t.__value=y,z=!1}),xe(t)}function W(t){return"__value"in t?t.__value:t.value}var We=b('<div class="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg text-sm"> </div>'),Je=b('<h3 class="font-semibold mb-4">Invite a team member</h3> <form class="flex gap-3"><div class="flex-1"><!></div> <select class="bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-300"><option>Member</option><option>Admin</option><option>Viewer</option></select> <!></form>',1),Ke=b('<span class="text-zinc-500 ml-2"> </span>'),Qe=b('<select class="bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-xs text-zinc-300"><option>Admin</option><option>Member</option><option>Viewer</option></select>'),Ue=b('<button class="text-sm text-red-400 hover:text-red-300">Remove</button>'),Xe=b('<tr><td class="px-6 py-3"><div><span class="text-zinc-200"> </span> <!></div></td><td class="px-6 py-3"><!></td><td class="px-6 py-3 text-zinc-400"> </td><td class="px-6 py-3 text-right"><!></td></tr>'),Ye=b('<tr><td colspan="4" class="px-6 py-8 text-center text-zinc-500">No team members yet</td></tr>'),Ze=b('<tr><td class="px-6 py-3 text-zinc-300"> </td><td class="px-6 py-3"><!></td><td class="px-6 py-3 text-zinc-400"> </td><td class="px-6 py-3 text-right"><button class="text-sm text-red-400 hover:text-red-300">Cancel</button></td></tr>'),et=b('<h3 class="font-semibold">Pending invitations</h3> <!>',1),tt=b("<!> <!>",1),at=b('<p class="text-sm text-zinc-400">Are you sure you want to remove <span class="text-zinc-200"> </span> from your team? They will lose access immediately.</p>'),rt=b('<div class="max-w-4xl space-y-8"><!> <!> <!> <h3 class="font-semibold">Members</h3> <!> <!></div> <!>',1);function gt(t,g){Ce(g,!0);let I=E(ue([])),h=E(ue([])),z=E(""),y=E("member"),P=E(!1),x=E(""),$=E(null);Ae(T);async function T(){try{const[a,l]=await Promise.all([L.getMembers(),L.getInvitations()]);_(I,a.members,!0),_(h,l.invitations,!0)}catch{}}async function ge(){_(P,!0),_(x,"");try{await L.inviteMember(e(z),e(y)),_(z,""),await T()}catch(a){_(x,a instanceof Q?a.message:"Failed to send invite",!0)}finally{_(P,!1)}}async function he(a,l){try{await L.updateMemberRole(a,l),await T()}catch(d){_(x,d instanceof Q?d.message:"Failed to update role",!0)}}async function be(){if(e($))try{await L.removeMember(e($).id),_($,null),await T()}catch(a){_(x,a instanceof Q?a.message:"Failed to remove member",!0)}}async function ye(a){try{await L.revokeInvitation(a),await T()}catch(l){_(x,l instanceof Q?l.message:"Failed to revoke invitation",!0)}}var re=rt(),U=C(re),oe=n(U);je(oe,{title:"Team",description:"Manage your team members and invitations."});var ne=o(oe,2);{var $e=a=>{var l=We(),d=n(l,!0);i(l),F(()=>A(d,e(x))),s(a,l)};G(ne,a=>{e(x)&&a($e)})}var ie=o(ne,2);He(ie,{children:(a,l)=>{var d=Je(),w=o(C(d),2),p=n(w),r=n(p);Ne(r,{type:"email",placeholder:"colleague@company.com",required:!0,get value(){return e(z)},set value(k){_(z,k,!0)}}),i(p);var u=o(p,2),c=n(u);c.value=c.__value="member";var f=o(c);f.value=f.__value="admin";var M=o(f);M.value=M.__value="viewer",i(u);var R=o(u,2);te(R,{type:"submit",get loading(){return e(P)},get disabled(){return e(P)},children:(k,S)=>{D();var q=O("Invite");s(k,q)},$$slots:{default:!0}}),i(w),Ve("submit",w,k=>{k.preventDefault(),ge()}),Ge(u,()=>e(y),k=>_(y,k)),s(a,d)},$$slots:{default:!0}});var se=o(ie,4);pe(se,{columns:["Email","Role","Last login",""],children:(a,l)=>{var d=de(),w=C(d);ce(w,17,()=>e(I),me,(p,r)=>{var u=Xe(),c=n(u),f=n(c),M=n(f),R=n(M,!0);i(M);var k=o(M,2);{var S=m=>{var v=Ke(),B=n(v,!0);i(v),F(()=>A(B,e(r).name)),s(m,v)};G(k,m=>{e(r).name&&m(S)})}i(f),i(c);var q=o(c),V=n(q);{var X=m=>{fe(m,{variant:"success",children:(v,B)=>{D();var N=O("Owner");s(v,N)},$$slots:{default:!0}})},J=m=>{var v=Qe(),B=n(v);B.value=B.__value="admin";var N=o(B);N.value=N.__value="member";var le=o(N);le.value=le.__value="viewer",i(v);var ve;xe(v),F(()=>{ve!==(ve=e(r).role)&&(v.value=(v.__value=e(r).role)??"",ae(v,e(r).role))}),ee("change",v,Pe=>he(e(r).id,Pe.target.value)),s(m,v)};G(V,m=>{e(r).role==="owner"?m(X):m(J,!1)})}i(q);var j=o(q),H=n(j,!0);i(j);var Y=o(j),K=n(Y);{var Me=m=>{var v=Ue();ee("click",v,()=>{_($,e(r),!0)}),s(m,v)};G(K,m=>{e(r).role!=="owner"&&m(Me)})}i(Y),i(u),F(m=>{A(R,e(r).email),A(H,m)},[()=>e(r).lastLoginAt?_e(e(r).lastLoginAt):"Never"]),s(p,u)},p=>{var r=Ye();s(p,r)}),s(a,d)},$$slots:{default:!0}});var we=o(se,2);{var ke=a=>{var l=et(),d=o(C(l),2);pe(d,{columns:["Email","Role","Expires",""],children:(w,p)=>{var r=de(),u=C(r);ce(u,17,()=>e(h).filter(c=>!c.acceptedAt),me,(c,f)=>{var M=Ze(),R=n(M),k=n(R,!0);i(R);var S=o(R),q=n(S);fe(q,{children:(H,Y)=>{D();var K=O();F(()=>A(K,e(f).role)),s(H,K)},$$slots:{default:!0}}),i(S);var V=o(S),X=n(V,!0);i(V);var J=o(V),j=n(J);i(J),i(M),F(H=>{A(k,e(f).email),A(X,H)},[()=>_e(e(f).expiresAt)]),ee("click",j,()=>ye(e(f).id)),s(c,M)}),s(w,r)},$$slots:{default:!0}}),s(a,l)};G(we,a=>{e(h).length>0&&a(ke)})}i(U);var ze=o(U,2);{const a=d=>{var w=tt(),p=C(w);te(p,{variant:"secondary",onclick:()=>{_($,null)},children:(u,c)=>{D();var f=O("Cancel");s(u,f)},$$slots:{default:!0}});var r=o(p,2);te(r,{variant:"danger",onclick:be,children:(u,c)=>{D();var f=O("Remove");s(u,f)},$$slots:{default:!0}}),s(d,w)};let l=Le(()=>e($)!==null);Oe(ze,{get open(){return e(l)},onclose:()=>{_($,null)},title:"Remove team member",actions:a,children:(d,w)=>{var p=at(),r=o(n(p)),u=n(r,!0);i(r),D(),i(p),F(()=>{var c;return A(u,(c=e($))==null?void 0:c.email)}),s(d,p)},$$slots:{actions:!0,default:!0}})}s(t,re),De()}Te(["change","click"]);export{gt as component};
