import{_ as be,b as He}from"../chunks/xPaU1tKI.js";import{a as y,f as m}from"../chunks/BQbrFHdE.js";import{o as Be}from"../chunks/DKpGyjba.js";import{p as We,o as u,G as we,a as Z,g as t,m as n,h as Ke,s as v,k as ke,i as d,j as l,q as Qe,t as E,n as ze,I as Xe}from"../chunks/DEIXV2yr.js";import{d as Ye,s as A,a as $e}from"../chunks/Bv3bKQ8S.js";import{i as I}from"../chunks/BKTWmeyc.js";import{e as pe,i as fe}from"../chunks/Bgl9SafJ.js";import{r as ue,a as Je}from"../chunks/Bx2xMsXF.js";import{s as je}from"../chunks/QSA7lv9p.js";import{s as ee}from"../chunks/CH4Gho_O.js";import{b as Ue,a as Ze}from"../chunks/CohYFCEt.js";import{b as et}from"../chunks/DkV04bLW.js";import{a as Se}from"../chunks/CowlEwwk.js";import{H as tt,C as ve}from"../chunks/ARQSVmb3.js";import{S as Ce}from"../chunks/2BnSfrOL.js";var rt=m('<div class="flex items-center justify-center py-20"><!></div>'),at=m('<div class="text-center py-12"><p class="text-zinc-400 text-sm">No projects found. Connect Muninn to a project to see its knowledge graph.</p></div>'),st=m("<option> </option>"),it=m('<p class="text-red-400 text-sm"> </p>'),nt=m('<label class="flex items-center gap-1.5 text-xs text-zinc-400 cursor-pointer select-none"><input type="checkbox" class="rounded border-zinc-600 bg-zinc-800 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-0"/> <span class="w-2 h-2 rounded-full"></span> </label>'),ot=m('<div class="flex items-center justify-center h-[600px] bg-zinc-900 border border-zinc-800 rounded-xl"><!></div>'),lt=m('<div class="flex items-center justify-center h-full"><p class="text-zinc-500 text-sm">No graph data. Add files, decisions, and relationships to visualize the knowledge graph.</p></div>'),ct=m('<div class="w-full h-[600px] bg-zinc-950 border border-zinc-800 rounded-xl overflow-hidden"><!></div>'),dt=m('<span class="inline-block text-xs px-2 py-0.5 rounded bg-zinc-800 text-zinc-400 capitalize"> </span>'),pt=m('<div class="flex items-center gap-2"><span class="text-xs text-zinc-500">Fragility</span> <div class="flex-1 h-1.5 bg-zinc-800 rounded-full overflow-hidden"><div></div></div> <span> </span></div>'),ft=m('<div class="space-y-3"><div class="flex items-center justify-between"><span class="text-xs font-semibold uppercase tracking-wide"> </span> <button class="text-zinc-500 hover:text-zinc-300 text-sm">Close</button></div> <h3 class="text-sm font-medium text-white break-all"> </h3> <!> <!></div>'),ut=m('<div class="absolute top-4 right-4 w-72 z-10"><!></div>'),vt=m('<div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full"></span> <span class="text-xs text-zinc-500 capitalize"> </span></div>'),gt=m('<div><label for="graph-project-select" class="block text-sm font-medium text-zinc-300 mb-1.5">Project</label> <select id="graph-project-select" class="w-full max-w-sm bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"></select></div> <!> <div class="flex flex-wrap items-center gap-4 bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-3"><input type="text" placeholder="Search nodes..." class="max-w-[220px] px-3 py-1.5 bg-zinc-800 border border-zinc-700 rounded-lg text-white text-sm placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"/> <div class="flex items-center gap-4 flex-wrap"></div> <label class="flex items-center gap-1.5 text-xs text-zinc-400 cursor-pointer select-none ml-auto border-l border-zinc-700 pl-4"><input type="checkbox" class="rounded border-zinc-600 bg-zinc-800 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-0"/> Connect orphans</label></div> <div class="relative"><!> <!></div> <div class="flex items-center gap-6 px-4 py-2"><!> <div class="flex items-center gap-1.5 ml-4 border-l border-zinc-800 pl-4"><span class="w-2.5 h-2.5 rounded-full border-2 border-red-400 bg-transparent"></span> <span class="text-xs text-zinc-500">Fragile file (7+)</span></div></div>',1),ht=m('<div class="max-w-7xl space-y-6"><!> <!></div>');function Nt(Ae,Me){We(Me,!0);let V=u(we([])),K=u(null),k=u(null),g=u(null),ge=u(!0),te=u(!1),Q=u(null),X=u(""),L=u(we(new Set)),b=u(void 0),D=u(!0),F=u(!0),T=u(!0),G=u(!0),R=u(!0),Y=u(!0),J=u(!1);const U={file:"#06b6d4",decision:"#8b5cf6",learning:"#10b981",issue:"#ef4444",session:"#f59e0b"},Pe=ke(()=>`${t(D)}-${t(F)}-${t(T)}-${t(G)}-${t(R)}`);Be(async()=>{try{const r=await Se.getProjects();n(V,r.projects,!0),t(V).length>0&&n(K,t(V)[0].id,!0)}catch{}n(ge,!1)}),Z(()=>{const r=t(K);r!==null&&(n(te,!0),n(Q,null),n(g,null),n(J,!1),Se.getProjectGraph(r).then(a=>{n(k,a,!0),xe(a)}).catch(a=>{n(Q,a instanceof Error?a.message:"Failed to load graph",!0),n(k,null)}).finally(()=>{n(te,!1)}))}),Z(()=>{t(Pe),t(k)&&t(J)&&he()});let re=u(void 0);Z(()=>{const r=t(Y);t(k)&&t(re)!==void 0&&r!==t(re)&&(n(J,!1),xe(t(k))),n(re,r,!0)}),Z(()=>{if(!t(X)||!t(k)){n(L,new Set,!0);return}const r=t(X).toLowerCase();n(L,new Set(t(k).nodes.filter(a=>a.label.toLowerCase().includes(r)).map(a=>a.id)),!0)});function Ne(){const r=new Set;return t(D)&&r.add("file"),t(F)&&r.add("decision"),t(T)&&r.add("learning"),t(G)&&r.add("issue"),t(R)&&r.add("session"),r}async function he(){if(!t(b)||!t(k))return;const r=await be(()=>import("../chunks/6PKoUFgn.js"),[],import.meta.url),a=Ne();r.select(t(b)).selectAll("circle").style("display",s=>a.has(s.type)?null:"none"),r.select(t(b)).selectAll("text").style("display",s=>a.has(s.type)?null:"none"),r.select(t(b)).selectAll("line").style("display",s=>{const c=typeof s.source=="string"?s.source.split(":")[0]:s.source.type,_=typeof s.target=="string"?s.target.split(":")[0]:s.target.type;return a.has(c)&&a.has(_)?null:"none"})}function Oe(r){const a=[...r.edges],s=new Set;for(const c of a){const _=typeof c.source=="string"?c.source:c.source.id,z=typeof c.target=="string"?c.target:c.target.id;s.add(_),s.add(z)}for(const c of r.nodes.filter(_=>!s.has(_.id))){const _=r.nodes.find(z=>z.type===c.type&&s.has(z.id))||r.nodes.find(z=>s.has(z.id));_&&(a.push({source:c.id,target:_.id,type:"virtual",strength:1}),s.add(c.id))}return{nodes:r.nodes,edges:a}}async function xe(r){if(!t(b)||!r||r.nodes.length===0)return;const a=await be(()=>import("../chunks/6PKoUFgn.js"),[],import.meta.url),s=t(Y)?Oe(r):r,c=new Map;for(const e of s.edges){const p=typeof e.source=="string"?e.source:e.source.id,i=typeof e.target=="string"?e.target:e.target.id;c.set(p,(c.get(p)||0)+1),c.set(i,(c.get(i)||0)+1)}const _=e=>{const p=c.get(e)||0;return Math.min(35,6+Math.sqrt(p)*2)},z=e=>e.type!=="file"||!e.fragility?1:.4+e.fragility/10*.6,q=e=>e.type!=="file"||!e.fragility?"#18181b":e.fragility>=7?"#f87171":e.fragility>=4?"#fbbf24":"#18181b",H=e=>e.type!=="file"||!e.fragility?1.5:e.fragility>=7?3:e.fragility>=4?2:1.5,j=t(b).clientWidth,M=t(b).clientHeight;a.select(t(b)).selectAll("svg").remove();const B=a.select(t(b)).append("svg").attr("width",j).attr("height",M).attr("viewBox",[0,0,j,M]),S=B.append("g");B.call(a.zoom().scaleExtent([.1,4]).on("zoom",e=>{S.attr("transform",e.transform)}));const P=a.forceSimulation(s.nodes).force("link",a.forceLink(s.edges).id(e=>e.id).distance(e=>e.type==="virtual"?900:450).strength(e=>e.type==="virtual"?.02:.1)).force("charge",a.forceManyBody().strength(-600)).force("center",a.forceCenter(j/2,M/2)).force("collision",a.forceCollide().radius(e=>_(e.id)+150).strength(1)).force("x",a.forceX(j/2).strength(.008)).force("y",a.forceY(M/2).strength(.008)).stop(),se=Math.min(300,Math.ceil(Math.log(s.nodes.length)*50));for(let e=0;e<se;e++)P.tick();const ie=S.append("g").selectAll("line").data(s.edges).join("line").attr("stroke",e=>e.type==="virtual"?"#27272a":"#4a90a4").attr("stroke-opacity",e=>e.type==="virtual"?.3:.6).attr("stroke-width",e=>e.type==="virtual"?1:Math.max(1,e.strength/3)).attr("stroke-dasharray",e=>e.type==="virtual"?"3,3":"none").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),ne=S.append("g").selectAll("circle").data(s.nodes).join("circle").attr("r",e=>_(e.id)).attr("fill",e=>U[e.type]||"#64748b").attr("fill-opacity",e=>z(e)).attr("stroke",e=>t(L).has(e.id)?"#fff":q(e)).attr("stroke-width",e=>t(L).has(e.id)?3:H(e)).attr("cursor","pointer").style("filter",e=>t(L).size>0&&!t(L).has(e.id)?"opacity(0.3)":"none").attr("cx",e=>e.x).attr("cy",e=>e.y).on("click",(e,p)=>{n(g,p,!0)}).call(a.drag().on("start",(e,p)=>{e.active||P.alphaTarget(.3).restart(),p.fx=p.x,p.fy=p.y}).on("drag",(e,p)=>{p.fx=e.x,p.fy=e.y}).on("end",(e,p)=>{e.active||P.alphaTarget(0),p.fx=null,p.fy=null})),oe=S.append("g").selectAll("text").data(s.nodes).join("text").text(e=>e.label.length>30?e.label.substring(0,30)+"...":e.label).attr("font-size","12px").attr("font-weight","500").attr("fill","#a1a1aa").attr("dx",14).attr("dy",4).attr("x",e=>e.x).attr("y",e=>e.y);P.on("tick",()=>{ie.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),ne.attr("cx",e=>e.x).attr("cy",e=>e.y),oe.attr("x",e=>e.x).attr("y",e=>e.y)}),n(J,!0),he()}var ae=ht(),ye=d(ae);tt(ye,{title:"Knowledge Graph",description:"Visualize relationships between files, decisions, learnings, and issues."});var Ee=v(ye,2);{var Ie=r=>{var a=rt(),s=d(a);Ce(s,{size:"lg"}),l(a),y(r,a)},Le=r=>{ve(r,{children:(a,s)=>{var c=at();y(a,c)},$$slots:{default:!0}})},Ve=r=>{var a=gt(),s=Qe(a),c=v(d(s),2);pe(c,21,()=>t(V),fe,(i,o)=>{var f=st(),h=d(f,!0);l(f);var x={};E(()=>{A(h,t(o).name),x!==(x=t(o).id)&&(f.value=(f.__value=t(o).id)??"")}),y(i,f)}),l(c),l(s);var _=v(s,2);{var z=i=>{ve(i,{children:(o,f)=>{var h=it(),x=d(h);l(h),E(()=>A(x,`Failed to load graph: ${t(Q)??""}`)),y(o,h)},$$slots:{default:!0}})};I(_,i=>{t(Q)&&i(z)})}var q=v(_,2),H=d(q);ue(H);var j=v(H,2);pe(j,21,()=>[{key:"file",label:"Files",checked:t(D),toggle:()=>n(D,!t(D))},{key:"decision",label:"Decisions",checked:t(F),toggle:()=>n(F,!t(F))},{key:"learning",label:"Learnings",checked:t(T),toggle:()=>n(T,!t(T))},{key:"issue",label:"Issues",checked:t(G),toggle:()=>n(G,!t(G))},{key:"session",label:"Sessions",checked:t(R),toggle:()=>n(R,!t(R))}],fe,(i,o)=>{var f=nt(),h=d(f);ue(h);var x=v(h,2),w=v(x);l(f),E(()=>{Je(h,t(o).checked),ee(x,`background: ${U[t(o).key]??""}`),A(w,` ${t(o).label??""}`)}),$e("change",h,function(...C){var $;($=t(o).toggle)==null||$.apply(this,C)}),y(i,f)}),l(j);var M=v(j,2),B=d(M);ue(B),ze(),l(M),l(q);var S=v(q,2),P=d(S);{var se=i=>{var o=ot(),f=d(o);Ce(f,{}),l(o),y(i,o)},ie=i=>{var o=ct(),f=d(o);{var h=x=>{var w=lt();y(x,w)};I(f,x=>{(!t(k)||t(k).nodes.length===0)&&x(h)})}l(o),He(o,x=>n(b,x),()=>t(b)),y(i,o)};I(P,i=>{t(te)?i(se):i(ie,!1)})}var ne=v(P,2);{var oe=i=>{var o=ut(),f=d(o);ve(f,{children:(h,x)=>{var w=ft(),C=d(w),$=d(C),le=d($,!0);l($);var De=v($,2);l(C);var ce=v(C,2),Fe=d(ce,!0);l(ce);var me=v(ce,2);{var Te=N=>{var O=dt(),W=d(O,!0);l(O),E(()=>A(W,t(g).temperature)),y(N,O)};I(me,N=>{t(g).temperature&&N(Te)})}var Ge=v(me,2);{var Re=N=>{var O=pt(),W=v(d(O),2),_e=d(W);l(W);var de=v(W,2),qe=d(de);l(de),l(O),E(()=>{je(_e,1,`h-full rounded-full ${t(g).fragility>=7?"bg-red-400":t(g).fragility>=4?"bg-amber-400":"bg-emerald-400"}`),ee(_e,`width: ${t(g).fragility*10}%`),je(de,1,`text-xs ${t(g).fragility>=7?"text-red-400":t(g).fragility>=4?"text-amber-400":"text-zinc-400"}`),A(qe,`${t(g).fragility??""}/10`)}),y(N,O)};I(Ge,N=>{t(g).fragility!==void 0&&t(g).fragility>0&&N(Re)})}l(w),E(()=>{ee($,`color: ${U[t(g).type]??""}`),A(le,t(g).type),A(Fe,t(g).label)}),$e("click",De,()=>n(g,null)),y(h,w)},$$slots:{default:!0}}),l(o),y(i,o)};I(ne,i=>{t(g)&&i(oe)})}l(S);var e=v(S,2),p=d(e);pe(p,17,()=>Object.entries(U),fe,(i,o)=>{var f=ke(()=>Xe(t(o),2));let h=()=>t(f)[0],x=()=>t(f)[1];var w=vt(),C=d(w),$=v(C,2),le=d($,!0);l($),l(w),E(()=>{ee(C,`background: ${x()??""}`),A(le,h())}),y(i,w)}),ze(2),l(e),et(c,()=>t(K),i=>n(K,i)),Ue(H,()=>t(X),i=>n(X,i)),Ze(B,()=>t(Y),i=>n(Y,i)),y(r,a)};I(Ee,r=>{t(ge)?r(Ie):t(V).length===0?r(Le,1):r(Ve,!1)})}l(ae),y(Ae,ae),Ke()}Ye(["change","click"]);export{Nt as component};
